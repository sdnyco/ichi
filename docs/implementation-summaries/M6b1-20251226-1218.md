# M6b.1 — Weekly Availability (One Window Per Day)

## JSON Shape & Schema
- Replaced the single daily window with `place_profiles.availabilityWeekly` (JSONB). Structure: `{ mon|tue|...|sun: { start: number|null, end: number|null } }` (minutes since local midnight, [start, end), `null` = unavailable). Dropped `availabilityStartMinutes`/`availabilityEndMinutes`; `isAvailabilityEnabled` + `availabilityTimeZone` remain.

## Timezone & Midnight Windows
- Windows are interpreted in `availabilityTimeZone` (default `"Europe/Berlin"`). We convert `now` into that IANA zone via `Intl.DateTimeFormat`, so DST is handled automatically. If `start < end`, availability stays within the same day. If `start > end`, the window crosses midnight: we treat minutes ≥ start (same day) **or** minutes < end (next day) as available, including spillover into the following day.

## Evaluator & Query
- `src/lib/availability.ts` now reads the weekly schedule, evaluates current weekday plus the previous day for midnight-crossing tails, and short-circuits when `isAvailabilityEnabled` is false or the schedule is missing. `getAnchoredAndAvailableUserIdsForPlace` reuses the upgraded helper so later ping eligibility runs on anchored + available users with bans/blocks applied.

## UI & Editing
- The self-only profile sheet now shows a 7-row editor (Mon–Sun). Each row has start/end `HH:MM` inputs (15 min step). Leaving both blank keeps the day unavailable; incomplete rows show inline “finish both times”, and identical start/end shows a “times must differ” warning. The entire availability card now lives at the bottom of the profile sheet, with start/end inputs laid out side-by-side (50/50) for quicker editing and a white calendar icon that matches the dark theme.
- Partial edits stay local until both fields are valid (or cleared), preventing inputs from resetting mid-entry; only completed rows are pushed to the server, so warnings no longer flash while typing.

## Deprecation Notes
- Legacy single-window columns were removed entirely instead of dual-writing (M6b data is transient pre-launch). The new JSON shape is the sole source of truth; future migrations (M6c+) can safely build on it without worrying about flat fields.


