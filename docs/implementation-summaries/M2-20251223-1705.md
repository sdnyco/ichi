# M2 — Place Read Path (Implementation Summary)
Date: 2025-12-23
Run: M2-20251223-1705

## Goal
Introduce the read-only place experience: model the initial schema, add portal/Place query helpers, and surface active check-ins on the canonical place page.

## Implemented
- Defined core Supabase tables (places, portals, users, place_profiles, check_ins) with indices + relations in Drizzle.
- Added singleton Postgres client factory plus server-side query helpers for portal and place lookups.
- Replaced the legacy venue route with `/place/[slug]` and added `/p/[code]` ingress that redirects portals to their canonical place.
- Localized the new UI strings and render a lightweight gallery that shows alias + relative start/end times for active check-ins.
- Updated product docs to use the new “place” terminology everywhere.

## Files Added / Updated
- Added: `src/app/place/[slug]/page.tsx`, `src/app/p/[code]/page.tsx`
- Added: `src/db/index.ts`, `src/db/queries/portals.ts`, `src/db/queries/places.ts`
- Added: `drizzle/0000_needy_angel.sql` (auto-generated) + meta snapshot
- Updated: `src/db/schema.ts`, `src/locales/*.json`, `docs/implementation-summaries/M1-20251223-1620.md`, `MILESTONES.md`, `PRD.md`, plus supporting config

## Behavioral Notes
- Visiting `/p/[code]` resolves enabled portals and immediately redirects to `/place/[slug]`.
- `/place/[slug]` now renders name, optional address, and a simple gallery list of active check-ins with localized relative timing strings.
- Requests are read-only; there are still no write flows, auth screens, or Supabase mutations.

## Schema / DB Notes
- Commands run: `npx drizzle-kit generate`, `npx drizzle-kit migrate` (blocked because `DATABASE_URL` is unavailable inside the sandbox; needs to be run on the host with real credentials).
- Migration `drizzle/0000_needy_angel.sql` creates all five tables, foreign keys, unique constraints, and the `placeId + expiresAt` index on `check_ins`.

## Known Issues / Follow-ups
- Actual Supabase migration still needs to be applied by running `npx drizzle-kit migrate` with a configured `DATABASE_URL`.
- No data seeding yet; galleries will surface once check-ins exist in the DB.
- Addendum (2025-12-23 17:45): Next.js dynamic route params now awaited in `/place/[slug]/page.tsx` to match the current App Router contract.

## Next
- Move into M3 (likely check-in creation flows) so places can accumulate gallery activity from real users.

